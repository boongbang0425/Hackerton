<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ì˜ˆìˆ  ì„œì¬ â€” Art Library</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;600;700;900&family=Pretendard:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
<style>
:root {
  --bg-primary: #1a1612;
  --bg-secondary: #231f1a;
  --bg-shelf: #2a2420;
  --bg-card: #312b25;
  --text-primary: #f0e6d6;
  --text-secondary: #a89882;
  --text-muted: #6d6052;
  --accent-gold: #c8a55c;
  --accent-warm: #d4764e;
  --accent-rose: #b5606a;
  --accent-blue: #5a7a9a;
  --accent-green: #6a8a6a;
  --accent-purple: #7a6a9a;
  --accent-teal: #5a8a8a;
  --shelf-wood: #3d3228;
  --shelf-shadow: rgba(0,0,0,0.5);
  --radius-sm: 6px;
  --radius-md: 12px;
  --radius-lg: 20px;
  --font-serif: 'Noto Serif KR', 'Playfair Display', serif;
  --font-sans: 'Pretendard', -apple-system, sans-serif;
  --shadow-book: 2px 4px 12px rgba(0,0,0,0.4);
  --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

html, body {
  height: 100%;
  font-family: var(--font-sans);
  background: var(--bg-primary);
  color: var(--text-primary);
  overflow: hidden;
}

/* ====== SCREENS ====== */
.screen {
  position: fixed;
  inset: 0;
  display: none;
  flex-direction: column;
  overflow: hidden;
  z-index: 1;
}
.screen.active { display: flex; z-index: 10; }

/* ====== SPLASH SCREEN ====== */
#splash {
  background: var(--bg-primary);
  justify-content: center;
  align-items: center;
  cursor: pointer;
}

.splash-content {
  text-align: center;
  opacity: 0;
  animation: fadeUp 1s ease forwards 0.3s;
}

.splash-title {
  font-family: var(--font-serif);
  font-size: 2.2rem;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 0.5rem;
  letter-spacing: -0.02em;
}

.splash-subtitle {
  font-size: 0.95rem;
  color: var(--text-secondary);
  margin-bottom: 2.5rem;
  font-weight: 300;
}

.art-icons {
  display: flex;
  gap: 1.2rem;
  justify-content: center;
  flex-wrap: wrap;
  margin-bottom: 3rem;
}

.art-icon {
  width: 52px;
  height: 52px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.4rem;
  opacity: 0;
  transform: translateY(20px) scale(0.8);
  animation: iconPop 0.5s ease forwards;
  border: 2px solid rgba(200,165,92,0.2);
  background: rgba(200,165,92,0.05);
  transition: var(--transition);
}
.art-icon:hover {
  transform: scale(1.15) !important;
  border-color: var(--accent-gold);
  background: rgba(200,165,92,0.15);
}
.art-icon:nth-child(1) { animation-delay: 0.6s; }
.art-icon:nth-child(2) { animation-delay: 0.75s; }
.art-icon:nth-child(3) { animation-delay: 0.9s; }
.art-icon:nth-child(4) { animation-delay: 1.05s; }
.art-icon:nth-child(5) { animation-delay: 1.2s; }
.art-icon:nth-child(6) { animation-delay: 1.35s; }
.art-icon:nth-child(7) { animation-delay: 1.5s; }

.splash-cta {
  font-size: 0.85rem;
  color: var(--text-muted);
  opacity: 0;
  animation: fadeUp 0.6s ease forwards 2s;
}

/* ====== AUTH SCREEN ====== */
#auth {
  background: var(--bg-primary);
  justify-content: center;
  align-items: center;
  padding: 2rem;
}

.auth-box {
  width: 100%;
  max-width: 380px;
  text-align: center;
}

.auth-title {
  font-family: var(--font-serif);
  font-size: 1.8rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
}

.auth-desc {
  color: var(--text-secondary);
  font-size: 0.9rem;
  margin-bottom: 2rem;
}

.social-btn {
  width: 100%;
  padding: 14px;
  border-radius: var(--radius-md);
  border: 1px solid rgba(255,255,255,0.08);
  background: var(--bg-card);
  color: var(--text-primary);
  font-size: 0.95rem;
  font-family: var(--font-sans);
  cursor: pointer;
  margin-bottom: 0.75rem;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.6rem;
  transition: var(--transition);
}
.social-btn:hover {
  background: var(--bg-shelf);
  border-color: var(--accent-gold);
  transform: translateY(-1px);
}

.divider {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin: 1.5rem 0;
  color: var(--text-muted);
  font-size: 0.8rem;
}
.divider::before, .divider::after {
  content: '';
  flex: 1;
  height: 1px;
  background: rgba(255,255,255,0.06);
}

.input-field {
  width: 100%;
  padding: 13px 16px;
  border-radius: var(--radius-md);
  border: 1px solid rgba(255,255,255,0.08);
  background: var(--bg-card);
  color: var(--text-primary);
  font-size: 0.9rem;
  font-family: var(--font-sans);
  margin-bottom: 0.75rem;
  outline: none;
  transition: var(--transition);
}
.input-field:focus {
  border-color: var(--accent-gold);
  box-shadow: 0 0 0 3px rgba(200,165,92,0.1);
}
.input-field::placeholder { color: var(--text-muted); }

.primary-btn {
  width: 100%;
  padding: 14px;
  border-radius: var(--radius-md);
  border: none;
  background: var(--accent-gold);
  color: var(--bg-primary);
  font-size: 0.95rem;
  font-weight: 600;
  font-family: var(--font-sans);
  cursor: pointer;
  transition: var(--transition);
  margin-top: 0.5rem;
}
.primary-btn:hover {
  background: #d4b06a;
  transform: translateY(-1px);
  box-shadow: 0 4px 20px rgba(200,165,92,0.3);
}

/* ====== ONBOARDING SCREEN ====== */
#onboarding {
  background: var(--bg-primary);
  justify-content: center;
  align-items: center;
  padding: 2rem;
}

.onboard-box {
  width: 100%;
  max-width: 420px;
}

.onboard-step {
  display: none;
  animation: fadeUp 0.4s ease;
}
.onboard-step.active { display: block; }

.onboard-label {
  font-size: 0.75rem;
  color: var(--accent-gold);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  margin-bottom: 0.6rem;
}

.onboard-heading {
  font-family: var(--font-serif);
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 1.5rem;
}

.character-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.character-card {
  aspect-ratio: 1;
  border-radius: var(--radius-md);
  border: 2px solid rgba(255,255,255,0.06);
  background: var(--bg-card);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: var(--transition);
  gap: 0.5rem;
}
.character-card:hover, .character-card.selected {
  border-color: var(--accent-gold);
  background: rgba(200,165,92,0.08);
  transform: translateY(-2px);
}
.character-card .char-emoji { font-size: 2rem; }
.character-card .char-name {
  font-size: 0.75rem;
  color: var(--text-secondary);
}

.progress-dots {
  display: flex;
  justify-content: center;
  gap: 0.5rem;
  margin-top: 2rem;
}
.dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--text-muted);
  transition: var(--transition);
}
.dot.active {
  background: var(--accent-gold);
  width: 24px;
  border-radius: 4px;
}

/* ====== MAIN DASHBOARD ====== */
#dashboard {
  background: var(--bg-primary);
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}

.dash-header {
  padding: 1rem 1.25rem 0.75rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  background: var(--bg-primary);
  z-index: 20;
  border-bottom: 1px solid rgba(255,255,255,0.04);
}

.dash-user {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.user-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--accent-gold), var(--accent-warm));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  cursor: pointer;
}

.user-info .library-name {
  font-family: var(--font-serif);
  font-size: 1rem;
  font-weight: 600;
}
.user-info .library-level {
  font-size: 0.72rem;
  color: var(--accent-gold);
  display: flex;
  align-items: center;
  gap: 0.3rem;
}

.dash-actions {
  display: flex;
  gap: 0.5rem;
}

.icon-btn {
  width: 38px;
  height: 38px;
  border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.06);
  background: transparent;
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 1.1rem;
  transition: var(--transition);
}
.icon-btn:hover {
  border-color: var(--accent-gold);
  color: var(--accent-gold);
  background: rgba(200,165,92,0.06);
}

/* View Tabs */
.view-tabs {
  display: flex;
  gap: 0.25rem;
  padding: 0.75rem 1.25rem;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}
.view-tabs::-webkit-scrollbar { display: none; }

.view-tab {
  padding: 6px 14px;
  border-radius: 20px;
  border: 1px solid rgba(255,255,255,0.06);
  background: transparent;
  color: var(--text-muted);
  font-size: 0.78rem;
  font-family: var(--font-sans);
  cursor: pointer;
  white-space: nowrap;
  transition: var(--transition);
}
.view-tab:hover { color: var(--text-secondary); }
.view-tab.active {
  background: var(--accent-gold);
  color: var(--bg-primary);
  border-color: var(--accent-gold);
  font-weight: 600;
}

/* Bookshelf View */
.bookshelf-view {
  padding: 0 1.25rem 6rem;
}

.shelf-section {
  margin-bottom: 0.5rem;
}

.shelf-label {
  font-size: 0.7rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  padding: 0.75rem 0 0.5rem;
}

.shelf-row {
  position: relative;
  min-height: 160px;
  display: flex;
  align-items: flex-end;
  gap: 4px;
  padding: 0 12px 0;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}
.shelf-row::-webkit-scrollbar { display: none; }

.shelf-base {
  position: relative;
  padding-bottom: 12px;
  margin-bottom: 1rem;
}
.shelf-base::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: -0.5rem;
  right: -0.5rem;
  height: 12px;
  background: linear-gradient(180deg, var(--shelf-wood), #2e2620);
  border-radius: 0 0 4px 4px;
  box-shadow: 0 4px 8px var(--shelf-shadow), inset 0 2px 0 rgba(255,255,255,0.04);
}

.book-spine {
  flex-shrink: 0;
  border-radius: 2px 4px 4px 2px;
  cursor: pointer;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  writing-mode: vertical-rl;
  text-orientation: mixed;
  font-size: 0.65rem;
  font-weight: 500;
  color: rgba(255,255,255,0.85);
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: var(--shadow-book);
  transition: transform 0.25s ease, box-shadow 0.25s ease;
  padding: 8px 0;
  letter-spacing: 0.03em;
  overflow: hidden;
}
.book-spine::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: rgba(0,0,0,0.2);
}
.book-spine::after {
  content: '';
  position: absolute;
  right: 0;
  top: 5%;
  bottom: 5%;
  width: 1px;
  background: rgba(255,255,255,0.08);
}
.book-spine:hover {
  transform: translateY(-8px);
  box-shadow: 2px 8px 20px rgba(0,0,0,0.5);
  z-index: 5;
}

.book-spine .spine-pattern {
  position: absolute;
  inset: 0;
  opacity: 0.15;
  pointer-events: none;
}

/* List View */
.list-view {
  padding: 0 1.25rem 6rem;
  display: none;
}

.list-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem 0;
  border-bottom: 1px solid rgba(255,255,255,0.04);
  cursor: pointer;
  transition: var(--transition);
}
.list-item:hover { background: rgba(255,255,255,0.02); }

.list-color-bar {
  width: 4px;
  height: 48px;
  border-radius: 2px;
  flex-shrink: 0;
}

.list-info { flex: 1; }
.list-info .list-title {
  font-weight: 500;
  font-size: 0.9rem;
  margin-bottom: 0.2rem;
}
.list-info .list-meta {
  font-size: 0.75rem;
  color: var(--text-muted);
}

.list-rating {
  color: var(--accent-gold);
  font-size: 0.85rem;
}

/* Calendar View */
.calendar-view {
  padding: 0 1.25rem 6rem;
  display: none;
}

.cal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem 0;
}

.cal-month {
  font-family: var(--font-serif);
  font-size: 1.2rem;
  font-weight: 600;
}

.cal-nav {
  display: flex;
  gap: 0.5rem;
}

.cal-nav button {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.08);
  background: transparent;
  color: var(--text-secondary);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition);
}
.cal-nav button:hover {
  border-color: var(--accent-gold);
  color: var(--accent-gold);
}

.cal-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 2px;
}

.cal-day-name {
  text-align: center;
  font-size: 0.65rem;
  color: var(--text-muted);
  padding: 0.5rem 0;
  text-transform: uppercase;
}

.cal-day {
  aspect-ratio: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius-sm);
  font-size: 0.8rem;
  color: var(--text-secondary);
  position: relative;
  cursor: pointer;
  transition: var(--transition);
}
.cal-day:hover { background: rgba(255,255,255,0.04); }
.cal-day.has-entry { color: var(--text-primary); font-weight: 600; }
.cal-day.has-entry::after {
  content: '';
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--accent-gold);
  position: absolute;
  bottom: 4px;
}
.cal-day.empty { opacity: 0; pointer-events: none; }

/* Stack View */
.stack-view {
  padding: 1rem 1.25rem 6rem;
  display: none;
}

.stacks-container {
  display: flex;
  justify-content: space-around;
  align-items: flex-end;
  height: 50vh;
  padding: 1rem 0;
}

.stack-col {
  display: flex;
  flex-direction: column-reverse;
  align-items: center;
  gap: 2px;
  flex: 1;
}

.stack-book {
  width: 90%;
  max-width: 52px;
  height: 10px;
  border-radius: 1px;
  transition: var(--transition);
}
.stack-book:hover { transform: scaleX(1.1); }

.stack-label {
  font-size: 0.65rem;
  color: var(--text-muted);
  text-align: center;
  margin-top: 0.5rem;
}

.stack-count {
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--text-primary);
  font-family: var(--font-serif);
}

/* ====== BOTTOM NAV ====== */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 64px;
  background: rgba(26, 22, 18, 0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-top: 1px solid rgba(255,255,255,0.06);
  display: flex;
  align-items: center;
  justify-content: space-around;
  z-index: 100;
  padding-bottom: env(safe-area-inset-bottom);
}

.nav-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.2rem;
  cursor: pointer;
  padding: 0.5rem 1rem;
  border-radius: var(--radius-md);
  transition: var(--transition);
  background: transparent;
  border: none;
  color: var(--text-muted);
  font-family: var(--font-sans);
}
.nav-item .nav-icon { font-size: 1.3rem; }
.nav-item .nav-label { font-size: 0.6rem; letter-spacing: 0.03em; }
.nav-item:hover { color: var(--text-secondary); }
.nav-item.active { color: var(--accent-gold); }

.nav-add {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: var(--accent-gold);
  color: var(--bg-primary);
  border: none;
  font-size: 1.6rem;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 4px 16px rgba(200,165,92,0.3);
  transition: var(--transition);
  transform: translateY(-8px);
}
.nav-add:hover {
  transform: translateY(-12px);
  box-shadow: 0 6px 24px rgba(200,165,92,0.45);
}

/* ====== WRITE SCREEN ====== */
#write {
  background: var(--bg-primary);
  overflow-y: auto;
}

.write-header {
  padding: 1rem 1.25rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid rgba(255,255,255,0.04);
  position: sticky;
  top: 0;
  background: var(--bg-primary);
  z-index: 10;
}

.back-btn {
  background: transparent;
  border: none;
  color: var(--text-secondary);
  font-size: 1.3rem;
  cursor: pointer;
  padding: 0.25rem;
  transition: var(--transition);
}
.back-btn:hover { color: var(--accent-gold); }

.write-title-text {
  font-family: var(--font-serif);
  font-weight: 600;
  font-size: 1.05rem;
}

.write-body {
  padding: 1.5rem 1.25rem 6rem;
}

.write-section {
  margin-bottom: 2rem;
}

.write-label {
  font-size: 0.72rem;
  color: var(--accent-gold);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  margin-bottom: 0.75rem;
}

.category-selector {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 0.6rem;
}

.cat-btn {
  aspect-ratio: 1;
  border-radius: var(--radius-md);
  border: 1.5px solid rgba(255,255,255,0.06);
  background: var(--bg-card);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0.3rem;
  cursor: pointer;
  transition: var(--transition);
  color: var(--text-secondary);
}
.cat-btn:hover, .cat-btn.selected {
  border-color: var(--accent-gold);
  background: rgba(200,165,92,0.08);
  color: var(--accent-gold);
}
.cat-btn .cat-emoji { font-size: 1.5rem; }
.cat-btn .cat-name { font-size: 0.6rem; font-weight: 500; }

.write-input {
  width: 100%;
  padding: 12px 14px;
  border-radius: var(--radius-sm);
  border: 1px solid rgba(255,255,255,0.08);
  background: var(--bg-card);
  color: var(--text-primary);
  font-size: 0.9rem;
  font-family: var(--font-sans);
  outline: none;
  transition: var(--transition);
}
.write-input:focus {
  border-color: var(--accent-gold);
  box-shadow: 0 0 0 3px rgba(200,165,92,0.08);
}

.write-textarea {
  width: 100%;
  min-height: 140px;
  padding: 14px;
  border-radius: var(--radius-sm);
  border: 1px solid rgba(255,255,255,0.08);
  background: var(--bg-card);
  color: var(--text-primary);
  font-size: 0.9rem;
  font-family: var(--font-sans);
  outline: none;
  resize: vertical;
  line-height: 1.7;
  transition: var(--transition);
}
.write-textarea:focus {
  border-color: var(--accent-gold);
}
.write-textarea::placeholder { color: var(--text-muted); }

/* Star Rating */
.star-rating {
  display: flex;
  gap: 0.3rem;
}
.star {
  font-size: 1.5rem;
  cursor: pointer;
  color: var(--text-muted);
  transition: var(--transition);
}
.star.active, .star:hover { color: var(--accent-gold); }

/* Color Picker (Spine) */
.color-picker-row {
  display: flex;
  gap: 0.6rem;
  flex-wrap: wrap;
}
.color-swatch {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  cursor: pointer;
  border: 2px solid transparent;
  transition: var(--transition);
}
.color-swatch:hover, .color-swatch.selected {
  border-color: #fff;
  transform: scale(1.15);
}

/* Pattern Picker */
.pattern-row {
  display: flex;
  gap: 0.6rem;
  margin-top: 0.75rem;
}
.pattern-chip {
  padding: 6px 14px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,0.08);
  background: var(--bg-card);
  color: var(--text-secondary);
  font-size: 0.75rem;
  cursor: pointer;
  transition: var(--transition);
}
.pattern-chip:hover, .pattern-chip.selected {
  border-color: var(--accent-gold);
  color: var(--accent-gold);
}

.tag-input-wrapper {
  display: flex;
  flex-wrap: wrap;
  gap: 0.4rem;
  padding: 10px 14px;
  border-radius: var(--radius-sm);
  border: 1px solid rgba(255,255,255,0.08);
  background: var(--bg-card);
  min-height: 44px;
  align-items: center;
}
.tag-chip {
  padding: 4px 10px;
  border-radius: 12px;
  background: rgba(200,165,92,0.15);
  color: var(--accent-gold);
  font-size: 0.75rem;
  display: flex;
  align-items: center;
  gap: 0.3rem;
}
.tag-chip .tag-remove {
  cursor: pointer;
  opacity: 0.6;
  transition: var(--transition);
}
.tag-chip .tag-remove:hover { opacity: 1; }
.tag-input {
  border: none;
  background: transparent;
  color: var(--text-primary);
  outline: none;
  font-size: 0.85rem;
  font-family: var(--font-sans);
  flex: 1;
  min-width: 80px;
}
.tag-input::placeholder { color: var(--text-muted); }

.toggle-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem 0;
}
.toggle-label {
  font-size: 0.9rem;
  color: var(--text-secondary);
}
.toggle {
  width: 44px;
  height: 24px;
  border-radius: 12px;
  background: var(--bg-card);
  border: 1px solid rgba(255,255,255,0.1);
  cursor: pointer;
  position: relative;
  transition: var(--transition);
}
.toggle::after {
  content: '';
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: var(--text-muted);
  position: absolute;
  top: 2px;
  left: 2px;
  transition: var(--transition);
}
.toggle.on {
  background: var(--accent-gold);
  border-color: var(--accent-gold);
}
.toggle.on::after {
  left: 22px;
  background: var(--bg-primary);
}

.submit-btn {
  width: 100%;
  padding: 16px;
  border-radius: var(--radius-md);
  border: none;
  background: var(--accent-gold);
  color: var(--bg-primary);
  font-size: 1rem;
  font-weight: 600;
  font-family: var(--font-sans);
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}
.submit-btn:hover {
  background: #d4b06a;
  box-shadow: 0 4px 20px rgba(200,165,92,0.3);
}

/* Ticket Upload */
.ticket-upload {
  display: none;
  margin-top: 0.75rem;
}
.ticket-upload.visible { display: block; }
.ticket-drop {
  border: 2px dashed rgba(255,255,255,0.1);
  border-radius: var(--radius-md);
  padding: 2rem;
  text-align: center;
  cursor: pointer;
  transition: var(--transition);
  color: var(--text-muted);
  font-size: 0.85rem;
}
.ticket-drop:hover {
  border-color: var(--accent-gold);
  color: var(--text-secondary);
}

/* ====== COMMUNITY SCREEN ====== */
#community {
  background: var(--bg-primary);
  overflow-y: auto;
}

.community-header {
  padding: 1rem 1.25rem;
  border-bottom: 1px solid rgba(255,255,255,0.04);
  position: sticky;
  top: 0;
  background: var(--bg-primary);
  z-index: 10;
}

.community-title {
  font-family: var(--font-serif);
  font-size: 1.3rem;
  font-weight: 700;
  margin-bottom: 0.75rem;
}

.filter-row {
  display: flex;
  gap: 0.5rem;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}
.filter-row::-webkit-scrollbar { display: none; }

.filter-chip {
  padding: 6px 14px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,0.06);
  background: transparent;
  color: var(--text-muted);
  font-size: 0.78rem;
  font-family: var(--font-sans);
  cursor: pointer;
  white-space: nowrap;
  transition: var(--transition);
}
.filter-chip:hover { color: var(--text-secondary); }
.filter-chip.active {
  background: var(--accent-gold);
  color: var(--bg-primary);
  border-color: var(--accent-gold);
}

.feed {
  padding: 0.75rem 1.25rem 6rem;
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.75rem;
}

.feed-card {
  border-radius: var(--radius-md);
  overflow: hidden;
  background: var(--bg-card);
  cursor: pointer;
  transition: var(--transition);
  border: 1px solid rgba(255,255,255,0.04);
}
.feed-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 24px rgba(0,0,0,0.3);
  border-color: rgba(200,165,92,0.2);
}

.feed-cover {
  height: 120px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5rem;
  position: relative;
}
.feed-cover::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 40px;
  background: linear-gradient(transparent, var(--bg-card));
}

.feed-info {
  padding: 0.6rem 0.75rem 0.75rem;
}
.feed-info .feed-work-title {
  font-size: 0.82rem;
  font-weight: 600;
  margin-bottom: 0.2rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.feed-info .feed-author {
  font-size: 0.7rem;
  color: var(--text-muted);
  margin-bottom: 0.4rem;
}
.feed-info .feed-excerpt {
  font-size: 0.72rem;
  color: var(--text-secondary);
  line-height: 1.5;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
.feed-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.4rem 0.75rem 0.6rem;
}
.feed-stars { font-size: 0.65rem; color: var(--accent-gold); }
.feed-likes {
  font-size: 0.7rem;
  color: var(--text-muted);
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

/* ====== STATS SCREEN ====== */
#stats {
  background: var(--bg-primary);
  overflow-y: auto;
}

.stats-header {
  padding: 1.25rem;
  text-align: center;
  border-bottom: 1px solid rgba(255,255,255,0.04);
}

.stats-title {
  font-family: var(--font-serif);
  font-size: 1.3rem;
  font-weight: 700;
}

.stats-body {
  padding: 1.25rem 1.25rem 6rem;
}

.stats-card {
  background: var(--bg-card);
  border-radius: var(--radius-md);
  padding: 1.25rem;
  margin-bottom: 1rem;
  border: 1px solid rgba(255,255,255,0.04);
}
.stats-card-title {
  font-size: 0.72rem;
  color: var(--accent-gold);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  margin-bottom: 1rem;
}

/* Radar Chart */
.radar-container {
  display: flex;
  justify-content: center;
  padding: 1rem 0;
}
.radar-svg { max-width: 260px; }

/* Monthly Chart */
.monthly-chart {
  display: flex;
  align-items: flex-end;
  gap: 6px;
  height: 120px;
  padding: 0.5rem 0;
}
.month-bar {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.3rem;
}
.bar {
  width: 100%;
  border-radius: 4px 4px 0 0;
  background: linear-gradient(180deg, var(--accent-gold), rgba(200,165,92,0.3));
  min-height: 4px;
  transition: height 0.5s ease;
}
.month-label {
  font-size: 0.55rem;
  color: var(--text-muted);
}

/* Collection Grid */
.collection-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 0.75rem;
}
.collection-item {
  text-align: center;
  cursor: pointer;
  transition: var(--transition);
}
.collection-item:hover { transform: scale(1.05); }
.collection-icon {
  width: 48px;
  height: 48px;
  border-radius: var(--radius-sm);
  margin: 0 auto 0.4rem;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.3rem;
  border: 1px solid rgba(255,255,255,0.08);
}
.collection-item.locked .collection-icon {
  opacity: 0.3;
  filter: grayscale(1);
}
.collection-name {
  font-size: 0.6rem;
  color: var(--text-secondary);
}

/* ====== DETAIL MODAL ====== */
#detail-modal {
  position: fixed;
  inset: 0;
  z-index: 200;
  display: none;
  flex-direction: column;
  background: var(--bg-primary);
  overflow-y: auto;
}
#detail-modal.active { display: flex; }

.detail-header {
  padding: 1rem 1.25rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid rgba(255,255,255,0.04);
  position: sticky;
  top: 0;
  background: var(--bg-primary);
  z-index: 10;
}

.detail-book-visual {
  height: 200px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
}

.detail-open-book {
  width: 280px;
  height: 180px;
  display: flex;
  perspective: 600px;
}

.book-left, .book-right {
  flex: 1;
  padding: 1.25rem;
  display: flex;
  flex-direction: column;
}
.book-left {
  background: var(--bg-card);
  border-radius: var(--radius-md) 0 0 var(--radius-md);
  border: 1px solid rgba(255,255,255,0.06);
  border-right: none;
  align-items: center;
  justify-content: center;
  text-align: center;
}
.book-right {
  background: var(--bg-secondary);
  border-radius: 0 var(--radius-md) var(--radius-md) 0;
  border: 1px solid rgba(255,255,255,0.06);
  border-left: 1px solid rgba(255,255,255,0.03);
  justify-content: center;
  font-size: 0.72rem;
  color: var(--text-secondary);
  line-height: 1.8;
}

.detail-title-text {
  font-family: var(--font-serif);
  font-size: 1rem;
  font-weight: 700;
  margin-bottom: 0.3rem;
}
.detail-category-emoji { font-size: 1.8rem; margin-bottom: 0.4rem; }
.detail-rating { color: var(--accent-gold); font-size: 0.9rem; }

.detail-body {
  padding: 1.25rem 1.25rem 6rem;
}
.detail-section { margin-bottom: 1.5rem; }
.detail-label {
  font-size: 0.7rem;
  color: var(--accent-gold);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  margin-bottom: 0.5rem;
}
.detail-review-text {
  font-size: 0.9rem;
  line-height: 1.8;
  color: var(--text-secondary);
}
.detail-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 0.4rem;
}
.detail-tag {
  padding: 4px 12px;
  border-radius: 12px;
  background: rgba(200,165,92,0.1);
  color: var(--accent-gold);
  font-size: 0.75rem;
}

.detail-actions {
  display: flex;
  gap: 0.75rem;
  margin-top: 1rem;
}
.action-btn {
  flex: 1;
  padding: 12px;
  border-radius: var(--radius-md);
  border: 1px solid rgba(255,255,255,0.08);
  background: transparent;
  color: var(--text-secondary);
  font-size: 0.85rem;
  font-family: var(--font-sans);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.4rem;
  transition: var(--transition);
}
.action-btn:hover {
  border-color: var(--accent-gold);
  color: var(--accent-gold);
}

/* ====== SEARCH MODAL ====== */
#search-modal {
  position: fixed;
  inset: 0;
  z-index: 200;
  display: none;
  flex-direction: column;
  background: var(--bg-primary);
}
#search-modal.active { display: flex; }

.search-bar {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 1rem 1.25rem;
  border-bottom: 1px solid rgba(255,255,255,0.04);
}
.search-input {
  flex: 1;
  padding: 10px 14px;
  border-radius: 20px;
  border: 1px solid rgba(255,255,255,0.08);
  background: var(--bg-card);
  color: var(--text-primary);
  font-size: 0.9rem;
  font-family: var(--font-sans);
  outline: none;
}
.search-input:focus {
  border-color: var(--accent-gold);
}

.search-results {
  padding: 1rem 1.25rem;
  overflow-y: auto;
  flex: 1;
}

.search-empty {
  text-align: center;
  padding: 3rem 1rem;
  color: var(--text-muted);
}

/* ====== BOOK INSERT ANIMATION ====== */
.book-fly-overlay {
  position: fixed;
  inset: 0;
  z-index: 300;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(26,22,18,0.85);
  backdrop-filter: blur(10px);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}
.book-fly-overlay.active {
  opacity: 1;
  pointer-events: auto;
}

.flying-book {
  width: 30px;
  height: 140px;
  border-radius: 2px 4px 4px 2px;
  background: var(--accent-gold);
  box-shadow: var(--shadow-book);
  animation: flyToShelf 1.2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  writing-mode: vertical-rl;
  display: flex;
  align-items: center;
  justify-content: center;
  color: rgba(0,0,0,0.6);
  font-size: 0.6rem;
  font-weight: 600;
}

.xp-toast {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: var(--accent-gold);
  color: var(--bg-primary);
  padding: 12px 24px;
  border-radius: var(--radius-md);
  font-weight: 700;
  font-size: 1rem;
  z-index: 350;
  opacity: 0;
  pointer-events: none;
  transition: all 0.5s ease;
}
.xp-toast.show {
  opacity: 1;
  transform: translate(-50%, -60%);
}

/* ====== ANIMATIONS ====== */
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(16px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes iconPop {
  from { opacity: 0; transform: translateY(20px) scale(0.8); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

@keyframes flyToShelf {
  0% { transform: scale(1) translateY(0); opacity: 1; }
  50% { transform: scale(0.8) translateY(-100px) rotate(5deg); opacity: 1; }
  100% { transform: scale(0.5) translateY(-200px) rotate(0deg); opacity: 0; }
}

@keyframes slideUp {
  from { transform: translateY(100%); }
  to { transform: translateY(0); }
}

/* Responsive */
@media (min-width: 500px) {
  .category-selector { grid-template-columns: repeat(7, 1fr); }
  .feed { grid-template-columns: repeat(3, 1fr); }
}
@media (min-width: 768px) {
  .feed { grid-template-columns: repeat(4, 1fr); }
}
</style>
</head>
<body>

<!-- ====== SPLASH SCREEN ====== -->
<div class="screen active" id="splash" onclick="goTo('auth')">
  <div class="splash-content">
    <div class="splash-title">ë‹¹ì‹ ì˜ ì˜ˆìˆ  ì„œì¬ë¥¼<br>ë§Œë“¤ì–´ë³´ì„¸ìš”</div>
    <div class="splash-subtitle">ê¸°ë¡í•˜ê³ , ìˆ˜ì§‘í•˜ê³ , ì „ì‹œí•˜ëŠ” ê³µê°„</div>
    <div class="art-icons">
      <div class="art-icon" title="ì˜í™”">ğŸ¬</div>
      <div class="art-icon" title="ì—°ê·¹">ğŸ­</div>
      <div class="art-icon" title="íšŒí™”">ğŸ¨</div>
      <div class="art-icon" title="ë¬´ìš©">ğŸ’ƒ</div>
      <div class="art-icon" title="ê±´ì¶•">ğŸ›ï¸</div>
      <div class="art-icon" title="ë¬¸í•™">ğŸ“–</div>
      <div class="art-icon" title="ìŒì•…">ğŸµ</div>
    </div>
    <div class="splash-cta">í™”ë©´ì„ í„°ì¹˜í•˜ì—¬ ì‹œì‘í•˜ê¸°</div>
  </div>
</div>

<!-- ====== AUTH SCREEN ====== -->
<div class="screen" id="auth">
  <div class="auth-box">
    <div class="auth-title">ì„œì¬ì— ì…ì¥í•˜ê¸°</div>
    <div class="auth-desc">ì†Œì…œ ë¡œê·¸ì¸ ë˜ëŠ” ì´ë©”ì¼ë¡œ ì‹œì‘í•˜ì„¸ìš”</div>
    <button class="social-btn" onclick="goTo('onboarding')">
      <span>ğŸ”µ</span> Googleë¡œ ì‹œì‘í•˜ê¸°
    </button>
    <button class="social-btn" onclick="goTo('onboarding')">
      <span>ğŸ’¬</span> ì¹´ì¹´ì˜¤ë¡œ ì‹œì‘í•˜ê¸°
    </button>
    <div class="divider">ë˜ëŠ”</div>
    <input class="input-field" type="email" placeholder="ì´ë©”ì¼ ì£¼ì†Œ">
    <input class="input-field" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <button class="primary-btn" onclick="goTo('onboarding')">ì´ë©”ì¼ë¡œ ì‹œì‘í•˜ê¸°</button>
  </div>
</div>

<!-- ====== ONBOARDING SCREEN ====== -->
<div class="screen" id="onboarding">
  <div class="onboard-box">
    <!-- Step 1 -->
    <div class="onboard-step active" data-step="1">
      <div class="onboard-label">Step 1 / 3</div>
      <div class="onboard-heading">ë‹‰ë„¤ì„ì„ ì •í•´ì£¼ì„¸ìš”</div>
      <input class="input-field" id="nickname-input" placeholder="ì˜ˆ: ì˜ˆìˆ ë¨¹ëŠ” í•˜ë§ˆ" value="ì˜ˆìˆ ë¨¹ëŠ” í•˜ë§ˆ">
      <button class="primary-btn" onclick="nextOnboardStep(2)" style="margin-top:1rem;">ë‹¤ìŒ</button>
    </div>
    <!-- Step 2 -->
    <div class="onboard-step" data-step="2">
      <div class="onboard-label">Step 2 / 3</div>
      <div class="onboard-heading">ì„œì¬ ì´ë¦„ì„ ì§€ì–´ì£¼ì„¸ìš”</div>
      <input class="input-field" id="library-name-input" placeholder="ì˜ˆ: ìƒˆë²½ 2ì‹œì˜ ê¸°ë¡ ë³´ê´€ì†Œ" value="ìƒˆë²½ 2ì‹œì˜ ê¸°ë¡ ë³´ê´€ì†Œ">
      <button class="primary-btn" onclick="nextOnboardStep(3)" style="margin-top:1rem;">ë‹¤ìŒ</button>
    </div>
    <!-- Step 3 -->
    <div class="onboard-step" data-step="3">
      <div class="onboard-label">Step 3 / 3</div>
      <div class="onboard-heading">ì‚¬ì„œ ìºë¦­í„°ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
      <div class="character-grid">
        <div class="character-card selected" onclick="selectCharacter(this)">
          <div class="char-emoji">ğŸ¦‰</div>
          <div class="char-name">ì˜¬ë¹¼ë¯¸ ì‚¬ì„œ</div>
        </div>
        <div class="character-card" onclick="selectCharacter(this)">
          <div class="char-emoji">ğŸ±</div>
          <div class="char-name">ê³ ì–‘ì´ ì‚¬ì„œ</div>
        </div>
        <div class="character-card" onclick="selectCharacter(this)">
          <div class="char-emoji">ğŸ¦Š</div>
          <div class="char-name">ì—¬ìš° ì‚¬ì„œ</div>
        </div>
        <div class="character-card" onclick="selectCharacter(this)">
          <div class="char-emoji">ğŸ»</div>
          <div class="char-name">ê³° ì‚¬ì„œ</div>
        </div>
        <div class="character-card" onclick="selectCharacter(this)">
          <div class="char-emoji">ğŸ§</div>
          <div class="char-name">í­ê·„ ì‚¬ì„œ</div>
        </div>
        <div class="character-card" onclick="selectCharacter(this)">
          <div class="char-emoji">ğŸ¦”</div>
          <div class="char-name">ê³ ìŠ´ë„ì¹˜ ì‚¬ì„œ</div>
        </div>
      </div>
      <button class="primary-btn" onclick="completeOnboarding()">ì„œì¬ ì—´ê¸° âœ¨</button>
    </div>
    <div class="progress-dots">
      <div class="dot active" data-dot="1"></div>
      <div class="dot" data-dot="2"></div>
      <div class="dot" data-dot="3"></div>
    </div>
  </div>
</div>

<!-- ====== MAIN DASHBOARD ====== -->
<div class="screen" id="dashboard">
  <div class="dash-header">
    <div class="dash-user">
      <div class="user-avatar" onclick="goTo('stats')">ğŸ¦‰</div>
      <div class="user-info">
        <div class="library-name">ìƒˆë²½ 2ì‹œì˜ ê¸°ë¡ ë³´ê´€ì†Œ</div>
        <div class="library-level">â­ Lv.3 Â· ë‚˜ë¬´ ì±…ì¥</div>
      </div>
    </div>
    <div class="dash-actions">
      <button class="icon-btn" onclick="openSearch()">ğŸ”</button>
    </div>
  </div>

  <div class="view-tabs">
    <button class="view-tab active" onclick="switchView('shelf', this)">ğŸ“š ì±…ì¥</button>
    <button class="view-tab" onclick="switchView('list', this)">ğŸ“‹ ë¦¬ìŠ¤íŠ¸</button>
    <button class="view-tab" onclick="switchView('calendar', this)">ğŸ“… ìº˜ë¦°ë”</button>
    <button class="view-tab" onclick="switchView('stack', this)">ğŸ“Š ìŒ“ì•„ë³´ê¸°</button>
  </div>

  <!-- Bookshelf View -->
  <div class="bookshelf-view" id="view-shelf">
    <div class="shelf-section">
      <div class="shelf-label">ìµœê·¼ ê¸°ë¡</div>
      <div class="shelf-base">
        <div class="shelf-row" id="shelf-recent"></div>
      </div>
    </div>
    <div class="shelf-section">
      <div class="shelf-label">ì˜í™”</div>
      <div class="shelf-base">
        <div class="shelf-row" id="shelf-movie"></div>
      </div>
    </div>
    <div class="shelf-section">
      <div class="shelf-label">ë¬¸í•™</div>
      <div class="shelf-base">
        <div class="shelf-row" id="shelf-literature"></div>
      </div>
    </div>
    <div class="shelf-section">
      <div class="shelf-label">ìŒì•…</div>
      <div class="shelf-base">
        <div class="shelf-row" id="shelf-music"></div>
      </div>
    </div>
  </div>

  <!-- List View -->
  <div class="list-view" id="view-list"></div>

  <!-- Calendar View -->
  <div class="calendar-view" id="view-calendar">
    <div class="cal-header">
      <div class="cal-month" id="cal-month-label">2026ë…„ 2ì›”</div>
      <div class="cal-nav">
        <button onclick="changeMonth(-1)">â—€</button>
        <button onclick="changeMonth(1)">â–¶</button>
      </div>
    </div>
    <div class="cal-grid" id="cal-grid"></div>
  </div>

  <!-- Stack View -->
  <div class="stack-view" id="view-stack">
    <div class="stacks-container" id="stacks-container"></div>
  </div>
</div>

<!-- ====== WRITE SCREEN ====== -->
<div class="screen" id="write">
  <div class="write-header">
    <button class="back-btn" onclick="goTo('dashboard')">â†</button>
    <span class="write-title-text">ìƒˆ ì±… ì¶”ê°€</span>
    <span style="width:30px;"></span>
  </div>
  <div class="write-body">
    <div class="write-section">
      <div class="write-label">ì¹´í…Œê³ ë¦¬</div>
      <div class="category-selector">
        <div class="cat-btn" data-cat="ì˜í™”" onclick="selectCategory(this)">
          <span class="cat-emoji">ğŸ¬</span>
          <span class="cat-name">ì˜í™”</span>
        </div>
        <div class="cat-btn" data-cat="ì—°ê·¹" onclick="selectCategory(this)">
          <span class="cat-emoji">ğŸ­</span>
          <span class="cat-name">ì—°ê·¹</span>
        </div>
        <div class="cat-btn" data-cat="íšŒí™”" onclick="selectCategory(this)">
          <span class="cat-emoji">ğŸ¨</span>
          <span class="cat-name">íšŒí™”</span>
        </div>
        <div class="cat-btn" data-cat="ë¬´ìš©" onclick="selectCategory(this)">
          <span class="cat-emoji">ğŸ’ƒ</span>
          <span class="cat-name">ë¬´ìš©</span>
        </div>
        <div class="cat-btn" data-cat="ê±´ì¶•" onclick="selectCategory(this)">
          <span class="cat-emoji">ğŸ›ï¸</span>
          <span class="cat-name">ê±´ì¶•</span>
        </div>
        <div class="cat-btn" data-cat="ë¬¸í•™" onclick="selectCategory(this)">
          <span class="cat-emoji">ğŸ“–</span>
          <span class="cat-name">ë¬¸í•™</span>
        </div>
        <div class="cat-btn" data-cat="ìŒì•…" onclick="selectCategory(this)">
          <span class="cat-emoji">ğŸµ</span>
          <span class="cat-name">ìŒì•…</span>
        </div>
      </div>
    </div>

    <!-- Dynamic fields based on category -->
    <div id="contextual-fields"></div>

    <div class="write-section">
      <div class="write-label">ì‘í’ˆ ì •ë³´</div>
      <input class="write-input" id="write-title" placeholder="ì‘í’ˆ ì œëª©" style="margin-bottom:0.75rem;">
      <input class="write-input" id="write-date" type="date" style="margin-bottom:0.75rem;">
    </div>

    <div class="write-section">
      <div class="write-label">ë³„ì </div>
      <div class="star-rating" id="star-rating">
        <span class="star" data-val="1" onclick="setRating(1)">â˜…</span>
        <span class="star" data-val="2" onclick="setRating(2)">â˜…</span>
        <span class="star" data-val="3" onclick="setRating(3)">â˜…</span>
        <span class="star" data-val="4" onclick="setRating(4)">â˜…</span>
        <span class="star" data-val="5" onclick="setRating(5)">â˜…</span>
      </div>
    </div>

    <div class="write-section">
      <div class="write-label">ë¦¬ë·°</div>
      <textarea class="write-textarea" id="write-review" placeholder="ì´ ì‘í’ˆì— ëŒ€í•œ ë‚˜ì˜ ê¸°ë¡ì„ ë‚¨ê²¨ë³´ì„¸ìš”..."></textarea>
    </div>

    <div class="write-section">
      <div class="write-label">ì±…ë“± ê¾¸ë¯¸ê¸°</div>
      <div class="color-picker-row" id="color-picker"></div>
      <div class="pattern-row" id="pattern-picker"></div>
    </div>

    <!-- Ticket Upload (for ì˜í™”/ì—°ê·¹/íšŒí™”) -->
    <div class="write-section ticket-upload" id="ticket-upload-section">
      <div class="write-label">ğŸ« í‹°ì¼“ ì•„ì¹´ì´ë¹™</div>
      <div class="ticket-drop" onclick="document.getElementById('ticket-file').click()">
        ğŸ“¸ í‹°ì¼“ ì‚¬ì§„ì„ ì˜¬ë ¤ë³´ì„¸ìš”<br><small>ì±…ê°ˆí”¼ì²˜ëŸ¼ ì±… ì‚¬ì´ì— ë¼ì›Œë“œë ¤ìš”</small>
      </div>
      <input type="file" id="ticket-file" accept="image/*" style="display:none;">
    </div>

    <div class="write-section">
      <div class="write-label">íƒœê·¸</div>
      <div class="tag-input-wrapper" id="tag-wrapper">
        <input class="tag-input" id="tag-input" placeholder="#ì¸ìƒì‘ #ìš°ìš¸í• ë•Œ" onkeydown="handleTag(event)">
      </div>
    </div>

    <div class="write-section">
      <div class="toggle-row">
        <span class="toggle-label">ğŸ”’ ë¹„ê³µê°œ (ë‚˜ë§Œ ë³´ê¸°)</span>
        <div class="toggle" id="private-toggle" onclick="this.classList.toggle('on')"></div>
      </div>
    </div>

    <button class="submit-btn" onclick="submitBook()">ğŸ“š ì±…ì¥ì— ê½‚ê¸°</button>
  </div>
</div>

<!-- ====== COMMUNITY SCREEN ====== -->
<div class="screen" id="community">
  <div class="community-header">
    <div class="community-title">ğŸ”­ ê´‘ì¥</div>
    <div class="filter-row">
      <button class="filter-chip active" onclick="selectFilter(this)">ìµœì‹ ìˆœ</button>
      <button class="filter-chip" onclick="selectFilter(this)">ì¸ê¸°ìˆœ</button>
      <button class="filter-chip" onclick="selectFilter(this)">íŒ”ë¡œì‰</button>
      <button class="filter-chip" onclick="selectFilter(this)">ğŸ¬ ì˜í™”</button>
      <button class="filter-chip" onclick="selectFilter(this)">ğŸ­ ì—°ê·¹</button>
      <button class="filter-chip" onclick="selectFilter(this)">ğŸ¨ íšŒí™”</button>
      <button class="filter-chip" onclick="selectFilter(this)">ğŸ“– ë¬¸í•™</button>
      <button class="filter-chip" onclick="selectFilter(this)">ğŸµ ìŒì•…</button>
    </div>
  </div>
  <div class="feed" id="community-feed"></div>
</div>

<!-- ====== STATS SCREEN ====== -->
<div class="screen" id="stats">
  <div class="stats-header">
    <button class="back-btn" onclick="goTo('dashboard')" style="position:absolute;left:1.25rem;">â†</button>
    <div class="stats-title">ğŸ“Š ë‚˜ì˜ ì˜ˆìˆ  í†µê³„</div>
  </div>
  <div class="stats-body">
    <div class="stats-card">
      <div class="stats-card-title">ì˜ˆìˆ  ì„±í–¥ ë ˆì´ë”</div>
      <div class="radar-container">
        <svg class="radar-svg" viewBox="0 0 300 300" id="radar-chart"></svg>
      </div>
    </div>
    <div class="stats-card">
      <div class="stats-card-title">ì›”ë³„ ê¸°ë¡ ì¶”ì´</div>
      <div class="monthly-chart" id="monthly-chart"></div>
    </div>
    <div class="stats-card">
      <div class="stats-card-title">ì‚¬ì„œ ë„ê°</div>
      <div class="collection-grid" id="collection-grid"></div>
    </div>
  </div>
</div>

<!-- ====== DETAIL MODAL ====== -->
<div id="detail-modal">
  <div class="detail-header">
    <button class="back-btn" onclick="closeDetail()">â†</button>
    <span class="write-title-text">ë¦¬ë·° ìƒì„¸</span>
    <span style="width:30px;"></span>
  </div>
  <div class="detail-book-visual" id="detail-visual"></div>
  <div class="detail-body" id="detail-body"></div>
</div>

<!-- ====== SEARCH MODAL ====== -->
<div id="search-modal">
  <div class="search-bar">
    <button class="back-btn" onclick="closeSearch()">â†</button>
    <input class="search-input" id="search-input" placeholder="ì‘í’ˆëª…, íƒœê·¸ë¡œ ê²€ìƒ‰..." oninput="handleSearch()">
  </div>
  <div class="search-results" id="search-results">
    <div class="search-empty">ğŸ” ì„œì¬ì—ì„œ ê¸°ë¡ì„ ì°¾ì•„ë³´ì„¸ìš”</div>
  </div>
</div>

<!-- ====== BOOK FLY ANIMATION ====== -->
<div class="book-fly-overlay" id="book-fly-overlay">
  <div class="flying-book" id="flying-book"></div>
</div>
<div class="xp-toast" id="xp-toast">+30 XP âœ¨</div>

<!-- ====== BOTTOM NAV ====== -->
<div class="bottom-nav" id="bottom-nav" style="display:none;">
  <button class="nav-item active" onclick="navTo('dashboard', this)">
    <span class="nav-icon">ğŸ“š</span>
    <span class="nav-label">ì„œì¬</span>
  </button>
  <button class="nav-item" onclick="navTo('community', this)">
    <span class="nav-icon">ğŸ”­</span>
    <span class="nav-label">íƒìƒ‰</span>
  </button>
  <button class="nav-add" onclick="goTo('write')">+</button>
  <button class="nav-item" onclick="navTo('stats', this)">
    <span class="nav-icon">ğŸ“Š</span>
    <span class="nav-label">í†µê³„</span>
  </button>
  <button class="nav-item" onclick="openSearch()">
    <span class="nav-icon">ğŸ”</span>
    <span class="nav-label">ê²€ìƒ‰</span>
  </button>
</div>

<script>
// ========== STATE ==========
let state = {
  nickname: 'ì˜ˆìˆ ë¨¹ëŠ” í•˜ë§ˆ',
  libraryName: 'ìƒˆë²½ 2ì‹œì˜ ê¸°ë¡ ë³´ê´€ì†Œ',
  character: 'ğŸ¦‰',
  level: 3,
  xp: 280,
  currentRating: 0,
  selectedCategory: '',
  selectedColor: '#c8a55c',
  selectedPattern: 'none',
  tags: [],
  calMonth: 1, // 0-indexed
  calYear: 2026,
  books: []
};

// Sample books data
const sampleBooks = [
  { id: 1, title: 'ì¸ì‚¬ì´ë“œ ì•„ì›ƒ 2', category: 'ì˜í™”', emoji: 'ğŸ¬', color: '#5a7a9a', rating: 4.5, review: 'ê°ì •ì˜ ë³µì¡ì„±ì„ ì´ë ‡ê²Œ ì•„ë¦„ë‹µê²Œ í‘œí˜„í•  ìˆ˜ ìˆë‹¤ë‹ˆ. ë¶ˆì•ˆì´ë¼ëŠ” ê°ì •ì´ ë‚˜ìœ ê²ƒë§Œì€ ì•„ë‹ˆë¼ëŠ” ë©”ì‹œì§€ê°€ ì¸ìƒì ì´ì—ˆë‹¤.', tags: ['#ì¸ìƒì‘', '#ê°ë™'], date: '2026-01-15', thickness: 28, pattern: 'none' },
  { id: 2, title: 'ì‘ì€ ì•„ì”¨ë“¤', category: 'ë¬¸í•™', emoji: 'ğŸ“–', color: '#b5606a', rating: 4.0, review: 'ì¡° ë§ˆì¹˜ì˜ ë…ë¦½ì ì¸ ì •ì‹ ì´ 21ì„¸ê¸°ì—ë„ ì—¬ì „íˆ ë¹›ë‚œë‹¤. ì‹œëŒ€ë¥¼ ì´ˆì›”í•œ ì´ì•¼ê¸°.', tags: ['#í´ë˜ì‹', '#í˜ë¯¸ë‹ˆì¦˜'], date: '2026-01-20', thickness: 34, pattern: 'lines' },
  { id: 3, title: 'ë¼ ë¼ ëœë“œ', category: 'ì˜í™”', emoji: 'ğŸ¬', color: '#c8a55c', rating: 5.0, review: 'ê¿ˆê³¼ ì‚¬ë‘ ì‚¬ì´ì˜ ì„ íƒ. ë§ˆì§€ë§‰ ì¥ë©´ì—ì„œ í˜ë¦° ëˆˆë¬¼ì€ ì•„ì§ë„ ê¸°ì–µë‚œë‹¤.', tags: ['#ì¸ìƒì‘', '#ìš°ìš¸í• ë•Œ'], date: '2026-01-25', thickness: 26, pattern: 'dots' },
  { id: 4, title: 'ë¹ˆì„¼íŠ¸ ë°˜ ê³ í ì „ì‹œ', category: 'íšŒí™”', emoji: 'ğŸ¨', color: '#d4764e', rating: 4.5, review: 'ë³„ì´ ë¹›ë‚˜ëŠ” ë°¤ì„ ì‹¤ë¬¼ë¡œ ë³´ëŠ” ê°ë™. ë¶“í„°ì¹˜ í•˜ë‚˜í•˜ë‚˜ì— ë‹´ê¸´ ì—´ì •ì´ ëŠê»´ì¡Œë‹¤.', tags: ['#ì „ì‹œ', '#ê°ë™'], date: '2026-02-01', thickness: 22, pattern: 'brush' },
  { id: 5, title: 'ë¹„í‹€ì¦ˆ - Abbey Road', category: 'ìŒì•…', emoji: 'ğŸµ', color: '#6a8a6a', rating: 5.0, review: 'ìŒì•…ì˜ ì™„ë²½í•œ í˜•íƒœ. Come Togetherë¶€í„° ë§ˆì§€ë§‰ ë©”ë“¤ë¦¬ê¹Œì§€ í•œ ìˆœê°„ë„ ë†“ì¹  ìˆ˜ ì—†ë‹¤.', tags: ['#ëª…ë°˜', '#í´ë˜ì‹'], date: '2026-02-03', thickness: 20, pattern: 'notes' },
  { id: 6, title: 'í–„ë¦¿', category: 'ì—°ê·¹', emoji: 'ğŸ­', color: '#7a6a9a', rating: 4.0, review: 'ì¡´ì¬ì™€ ë¹„ì¡´ì¬ ì‚¬ì´ì—ì„œ ë°©í™©í•˜ëŠ” ì¸ê°„ì˜ ë³¸ì§ˆì„ ë¬´ëŒ€ ìœ„ì—ì„œ ì²´í—˜í–ˆë‹¤.', tags: ['#ì…°ìµìŠ¤í”¼ì–´', '#ëª…ì‘'], date: '2026-02-05', thickness: 30, pattern: 'none' },
  { id: 7, title: 'ë…¸ë¥´ì›¨ì´ì˜ ìˆ²', category: 'ë¬¸í•™', emoji: 'ğŸ“–', color: '#5a8a8a', rating: 3.5, review: 'ë¬´ë¼ì¹´ë¯¸ì˜ ë¬¸ì²´ëŠ” ì—¬ì „íˆ ë§¤ë ¥ì ì´ì§€ë§Œ, ì´ë²ˆì—” ì¡°ê¸ˆ ë©€ë¦¬ì„œ ë°”ë¼ë³´ê²Œ ë˜ì—ˆë‹¤.', tags: ['#ì¼ë³¸ë¬¸í•™', '#ì¬ë…'], date: '2026-01-10', thickness: 32, pattern: 'lines' },
  { id: 8, title: 'ê°€ìš°ë”” ì„±ê°€ì¡± ì„±ë‹¹', category: 'ê±´ì¶•', emoji: 'ğŸ›ï¸', color: '#d4764e', rating: 5.0, review: 'ì¸ê°„ì´ ë§Œë“  ê²ƒ ì¤‘ ê°€ì¥ ì‹ ì— ê°€ê¹Œìš´ ê³µê°„. ë¹›ì´ ìŠ¤í…Œì¸ë“œê¸€ë¼ìŠ¤ë¥¼ í†µê³¼í•˜ëŠ” ìˆœê°„ ì‹œê°„ì´ ë©ˆì·„ë‹¤.', tags: ['#ë°”ë¥´ì…€ë¡œë‚˜', '#ì¸ìƒê±´ì¶•'], date: '2025-12-20', thickness: 26, pattern: 'none' },
  { id: 9, title: 'í˜¸ë‘ê¹Œê¸° ì¸í˜•', category: 'ë¬´ìš©', emoji: 'ğŸ’ƒ', color: '#b5606a', rating: 4.0, review: 'ì°¨ì´ì½”í”„ìŠ¤í‚¤ì˜ ì„ ìœ¨ì— ë§ì¶° í¼ì³ì§€ëŠ” ê¿ˆì˜ ì„¸ê³„. ê²¨ìš¸ì— ê¼­ ë´ì•¼ í•  ê³µì—°.', tags: ['#ë°œë ˆ', '#ê²¨ìš¸'], date: '2025-12-25', thickness: 24, pattern: 'none' },
  { id: 10, title: 'ë“„: íŒŒíŠ¸ 2', category: 'ì˜í™”', emoji: 'ğŸ¬', color: '#c8a55c', rating: 4.5, review: 'ìŠ¤ì¼€ì¼ì´ ë‹¤ë¥¸ SF ì„œì‚¬ì‹œ. í•œìŠ¤ ì§ë¨¸ì˜ ìŒì•…ê³¼ ë¹Œë‡Œë¸Œì˜ ì—°ì¶œì´ ì™„ë²½í•œ ì¡°í™”.', tags: ['#SF', '#ê·¹ì¥í•„ìˆ˜'], date: '2026-01-30', thickness: 28, pattern: 'dots' },
  { id: 11, title: 'ì‡¼íŒ½ ë…¹í„´ ì „ê³¡', category: 'ìŒì•…', emoji: 'ğŸµ', color: '#5a7a9a', rating: 4.5, review: 'ìƒˆë²½ 2ì‹œì— ë“£ëŠ” ì‡¼íŒ½ì€ ë§ˆë²•ê³¼ë„ ê°™ë‹¤. íŠ¹íˆ Op.9 No.2ëŠ” ì˜ì›íˆ ì‚¬ë‘í•  ê³¡.', tags: ['#í´ë˜ì‹', '#ìƒˆë²½ê°ì„±'], date: '2026-02-06', thickness: 22, pattern: 'notes' },
  { id: 12, title: 'ë°ë¯¸ì•ˆ', category: 'ë¬¸í•™', emoji: 'ğŸ“–', color: '#7a6a9a', rating: 4.0, review: 'ìƒˆëŠ” ì•Œì—ì„œ ë‚˜ì˜¤ë ¤ê³  íˆ¬ìŸí•œë‹¤. 20ëŒ€ì— ë‹¤ì‹œ ì½ìœ¼ë‹ˆ ë˜ ë‹¤ë¥¸ ìš¸ë¦¼ì´ ìˆë‹¤.', tags: ['#í—¤ì„¸', '#ì„±ì¥'], date: '2026-01-05', thickness: 26, pattern: 'lines' },
];

state.books = [...sampleBooks];

const SPINE_COLORS = ['#c8a55c','#d4764e','#b5606a','#5a7a9a','#6a8a6a','#7a6a9a','#5a8a8a','#8a6a5a','#9a7a5a','#6a5a8a'];
const PATTERNS = [
  { id: 'none', name: 'ì—†ìŒ' },
  { id: 'lines', name: 'ì¤„ë¬´ëŠ¬' },
  { id: 'dots', name: 'ì ë¬´ëŠ¬' },
  { id: 'brush', name: 'ë¶“í„°ì¹˜' },
  { id: 'notes', name: 'ìŒí‘œ' },
  { id: 'diamond', name: 'ë‹¤ì´ì•„ëª¬ë“œ' },
];

const CATEGORIES = [
  { name: 'ì˜í™”', emoji: 'ğŸ¬', color: '#5a7a9a' },
  { name: 'ì—°ê·¹', emoji: 'ğŸ­', color: '#7a6a9a' },
  { name: 'íšŒí™”', emoji: 'ğŸ¨', color: '#d4764e' },
  { name: 'ë¬´ìš©', emoji: 'ğŸ’ƒ', color: '#b5606a' },
  { name: 'ê±´ì¶•', emoji: 'ğŸ›ï¸', color: '#8a6a5a' },
  { name: 'ë¬¸í•™', emoji: 'ğŸ“–', color: '#5a8a8a' },
  { name: 'ìŒì•…', emoji: 'ğŸµ', color: '#6a8a6a' },
];

// Community sample
const communityPosts = [
  { user: 'ë°¤í•˜ëŠ˜ì˜ ì˜í™”ê´€', title: 'ìœ„í”Œë˜ì‰¬', category: 'ì˜í™”', emoji: 'ğŸ¬', color: '#d4764e', rating: 5, excerpt: 'ë“œëŸ¼ ì†Œë¦¬ê°€ ì•„ì§ë„ ê·“ê°€ì— ë§´ëˆë‹¤. ì™„ë²½ì„ í–¥í•œ ì§‘ì°©ì˜ ëì€ ì–´ë””ì¸ê°€.', likes: 47 },
  { user: 'ì±…ë²Œë ˆ ë‹¤ëŒì¥', title: '1984', category: 'ë¬¸í•™', emoji: 'ğŸ“–', color: '#5a7a9a', rating: 4.5, excerpt: 'ì˜¤ì›°ì˜ ì˜ˆì–¸ì´ í˜„ì‹¤ì´ ë˜ì–´ê°€ëŠ” ëŠë‚Œ. ë¹… ë¸Œë¼ë”ê°€ ì§€ì¼œë³´ê³  ìˆë‹¤.', likes: 32 },
  { user: 'ìŒí‘œ ìˆ˜ì§‘ê°€', title: 'ë“œë·”ì‹œ ë‹¬ë¹›', category: 'ìŒì•…', emoji: 'ğŸµ', color: '#7a6a9a', rating: 5, excerpt: 'í”¼ì•„ë…¸ì˜ ìŒìƒ‰ì´ ë‹¬ë¹›ì²˜ëŸ¼ ë¶€ë“œëŸ½ê²Œ íë¥¸ë‹¤. ë°¤ì— ê¼­ ë“¤ì–´ì•¼ í•  ê³¡.', likes: 28 },
  { user: 'ê·¸ë¦¼ ì½ëŠ” ì—¬ì', title: 'ëª¨ë„¤ ìˆ˜ë ¨ ì „ì‹œ', category: 'íšŒí™”', emoji: 'ğŸ¨', color: '#6a8a6a', rating: 4, excerpt: 'ë¬¼ ìœ„ì— ë– ìˆëŠ” ë“¯í•œ ëª½í™˜ì ì¸ ìƒ‰ê°. ì‹¤ë¬¼ì˜ í¬ê¸°ì— ì••ë„ë˜ì—ˆë‹¤.', likes: 55 },
  { user: 'ë¬´ëŒ€ ìœ„ì˜ ì² í•™ì', title: 'ê³ ë„ë¥¼ ê¸°ë‹¤ë¦¬ë©°', category: 'ì—°ê·¹', emoji: 'ğŸ­', color: '#b5606a', rating: 4.5, excerpt: 'ê¸°ë‹¤ë¦¼ì˜ ë³¸ì§ˆì— ëŒ€í•´ ë‹¤ì‹œ ìƒê°í•˜ê²Œ ëœ ì‘í’ˆ. ê³µí—ˆí•¨ ì†ì˜ ì•„ë¦„ë‹¤ì›€.', likes: 19 },
  { user: 'ê±´ì¶• ì‚°ì±…ì', title: 'ì•ˆë„ íƒ€ë‹¤ì˜¤ ë¹›ì˜ êµíšŒ', category: 'ê±´ì¶•', emoji: 'ğŸ›ï¸', color: '#c8a55c', rating: 5, excerpt: 'ì½˜í¬ë¦¬íŠ¸ ë²½ ì‚¬ì´ë¡œ ë“¤ì–´ì˜¤ëŠ” ì‹­ìê°€ ëª¨ì–‘ì˜ ë¹›. ê±´ì¶•ì´ ì˜ˆìˆ ì´ ë˜ëŠ” ìˆœê°„.', likes: 41 },
  { user: 'ì¶¤ì¶”ëŠ” ë³„', title: 'ì§€ì ¤', category: 'ë¬´ìš©', emoji: 'ğŸ’ƒ', color: '#5a8a8a', rating: 4, excerpt: '2ë§‰ì˜ ìœŒë¦¬ êµ°ë¬´ê°€ ì••ë„ì . í´ë˜ì‹ ë°œë ˆì˜ ì§„ìˆ˜ë¥¼ ë³´ì—¬ì¤€ ë¬´ëŒ€.', likes: 23 },
  { user: 'ì‹œë„¤í•„ ê³ ì–‘ì´', title: 'ë´„ë‚ ì€ ê°„ë‹¤', category: 'ì˜í™”', emoji: 'ğŸ¬', color: '#5a7a9a', rating: 4.5, excerpt: 'ì‚¬ë‘ì´ ë– ë‚˜ê°€ëŠ” ê³¼ì •ì„ ì´í† ë¡ ë‹´ë‹´í•˜ê²Œ ê·¸ë ¤ë‚¸ í—ˆì§„í˜¸ ê°ë…ì˜ ê±¸ì‘.', likes: 38 },
];

// ========== NAVIGATION ==========
function goTo(screenId) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(screenId).classList.add('active');
  
  const showNav = ['dashboard', 'community', 'stats', 'write'].includes(screenId);
  document.getElementById('bottom-nav').style.display = showNav ? 'flex' : 'none';
  
  if (screenId === 'dashboard') renderDashboard();
  if (screenId === 'community') renderCommunity();
  if (screenId === 'stats') renderStats();
  if (screenId === 'write') initWriteScreen();
}

function navTo(screenId, el) {
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  if (el) el.classList.add('active');
  goTo(screenId);
}

// ========== ONBOARDING ==========
function nextOnboardStep(step) {
  if (step === 2) state.nickname = document.getElementById('nickname-input').value || 'ì˜ˆìˆ ë¨¹ëŠ” í•˜ë§ˆ';
  if (step === 3) state.libraryName = document.getElementById('library-name-input').value || 'ìƒˆë²½ 2ì‹œì˜ ê¸°ë¡ ë³´ê´€ì†Œ';
  
  document.querySelectorAll('.onboard-step').forEach(s => s.classList.remove('active'));
  document.querySelector(`.onboard-step[data-step="${step}"]`).classList.add('active');
  document.querySelectorAll('.dot').forEach(d => d.classList.remove('active'));
  document.querySelector(`.dot[data-dot="${step}"]`).classList.add('active');
}

function selectCharacter(el) {
  document.querySelectorAll('.character-card').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  state.character = el.querySelector('.char-emoji').textContent;
}

function completeOnboarding() {
  document.querySelector('.user-avatar').textContent = state.character;
  document.querySelector('.library-name').textContent = state.libraryName;
  goTo('dashboard');
}

// ========== DASHBOARD ==========
function renderDashboard() {
  renderShelf();
  renderListView();
  renderCalendar();
  renderStackView();
}

function getPatternSVG(pattern, color) {
  const lighter = color + '40';
  switch(pattern) {
    case 'lines': return `<svg width="100%" height="100%"><defs><pattern id="p-lines" width="6" height="6" patternUnits="userSpaceOnUse"><line x1="0" y1="0" x2="0" y2="6" stroke="${lighter}" stroke-width="1"/></pattern></defs><rect fill="url(#p-lines)" width="100%" height="100%"/></svg>`;
    case 'dots': return `<svg width="100%" height="100%"><defs><pattern id="p-dots" width="8" height="8" patternUnits="userSpaceOnUse"><circle cx="4" cy="4" r="1.5" fill="${lighter}"/></pattern></defs><rect fill="url(#p-dots)" width="100%" height="100%"/></svg>`;
    case 'brush': return `<svg width="100%" height="100%"><defs><pattern id="p-brush" width="12" height="12" patternUnits="userSpaceOnUse"><path d="M0 6Q3 2 6 6T12 6" fill="none" stroke="${lighter}" stroke-width="1.5"/></pattern></defs><rect fill="url(#p-brush)" width="100%" height="100%"/></svg>`;
    case 'notes': return `<svg width="100%" height="100%"><defs><pattern id="p-notes" width="14" height="14" patternUnits="userSpaceOnUse"><text x="2" y="11" font-size="8" fill="${lighter}">â™ª</text></pattern></defs><rect fill="url(#p-notes)" width="100%" height="100%"/></svg>`;
    case 'diamond': return `<svg width="100%" height="100%"><defs><pattern id="p-diamond" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M5 0L10 5L5 10L0 5Z" fill="none" stroke="${lighter}" stroke-width="0.8"/></pattern></defs><rect fill="url(#p-diamond)" width="100%" height="100%"/></svg>`;
    default: return '';
  }
}

function createSpineEl(book) {
  const spine = document.createElement('div');
  spine.className = 'book-spine';
  spine.style.width = book.thickness + 'px';
  spine.style.height = (100 + Math.random() * 50) + 'px';
  spine.style.background = book.color;
  spine.textContent = book.title;
  spine.onclick = () => openDetail(book);
  
  if (book.pattern && book.pattern !== 'none') {
    const patternDiv = document.createElement('div');
    patternDiv.className = 'spine-pattern';
    patternDiv.innerHTML = getPatternSVG(book.pattern, book.color);
    spine.appendChild(patternDiv);
  }
  return spine;
}

function renderShelf() {
  const recent = document.getElementById('shelf-recent');
  const movie = document.getElementById('shelf-movie');
  const literature = document.getElementById('shelf-literature');
  const music = document.getElementById('shelf-music');
  
  [recent, movie, literature, music].forEach(el => el.innerHTML = '');
  
  const sorted = [...state.books].sort((a,b) => new Date(b.date) - new Date(a.date));
  sorted.slice(0, 8).forEach(b => recent.appendChild(createSpineEl(b)));
  state.books.filter(b => b.category === 'ì˜í™”').forEach(b => movie.appendChild(createSpineEl(b)));
  state.books.filter(b => b.category === 'ë¬¸í•™').forEach(b => literature.appendChild(createSpineEl(b)));
  state.books.filter(b => b.category === 'ìŒì•…').forEach(b => music.appendChild(createSpineEl(b)));
}

function renderListView() {
  const container = document.getElementById('view-list');
  container.innerHTML = '';
  const sorted = [...state.books].sort((a,b) => new Date(b.date) - new Date(a.date));
  sorted.forEach(book => {
    const item = document.createElement('div');
    item.className = 'list-item';
    item.onclick = () => openDetail(book);
    item.innerHTML = `
      <div class="list-color-bar" style="background:${book.color}"></div>
      <div class="list-info">
        <div class="list-title">${book.emoji} ${book.title}</div>
        <div class="list-meta">${book.category} Â· ${book.date}</div>
      </div>
      <div class="list-rating">${'â˜…'.repeat(Math.floor(book.rating))}${'â˜†'.repeat(5-Math.floor(book.rating))}</div>
    `;
    container.appendChild(item);
  });
}

function renderCalendar() {
  const grid = document.getElementById('cal-grid');
  grid.innerHTML = '';
  const monthNames = ['1ì›”','2ì›”','3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”'];
  document.getElementById('cal-month-label').textContent = `${state.calYear}ë…„ ${monthNames[state.calMonth]}`;
  
  const dayNames = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
  dayNames.forEach(d => {
    const el = document.createElement('div');
    el.className = 'cal-day-name';
    el.textContent = d;
    grid.appendChild(el);
  });
  
  const firstDay = new Date(state.calYear, state.calMonth, 1).getDay();
  const daysInMonth = new Date(state.calYear, state.calMonth + 1, 0).getDate();
  
  for (let i = 0; i < firstDay; i++) {
    const empty = document.createElement('div');
    empty.className = 'cal-day empty';
    grid.appendChild(empty);
  }
  
  for (let d = 1; d <= daysInMonth; d++) {
    const dateStr = `${state.calYear}-${String(state.calMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const hasEntry = state.books.some(b => b.date === dateStr);
    const el = document.createElement('div');
    el.className = 'cal-day' + (hasEntry ? ' has-entry' : '');
    el.textContent = d;
    if (hasEntry) {
      const booksOnDay = state.books.filter(b => b.date === dateStr);
      el.onclick = () => openDetail(booksOnDay[0]);
    }
    grid.appendChild(el);
  }
}

function changeMonth(dir) {
  state.calMonth += dir;
  if (state.calMonth > 11) { state.calMonth = 0; state.calYear++; }
  if (state.calMonth < 0) { state.calMonth = 11; state.calYear--; }
  renderCalendar();
}

function renderStackView() {
  const container = document.getElementById('stacks-container');
  container.innerHTML = '';
  
  CATEGORIES.forEach(cat => {
    const books = state.books.filter(b => b.category === cat.name);
    const col = document.createElement('div');
    col.className = 'stack-col';
    
    books.forEach(b => {
      const block = document.createElement('div');
      block.className = 'stack-book';
      block.style.background = b.color;
      block.style.height = '10px';
      block.onclick = () => openDetail(b);
      col.appendChild(block);
    });
    
    const label = document.createElement('div');
    label.innerHTML = `<div class="stack-count">${books.length}</div><div class="stack-label">${cat.emoji}<br>${cat.name}</div>`;
    col.appendChild(label);
    container.appendChild(col);
  });
}

function switchView(view, tabEl) {
  document.querySelectorAll('.view-tab').forEach(t => t.classList.remove('active'));
  if (tabEl) tabEl.classList.add('active');
  
  ['shelf','list','calendar','stack'].forEach(v => {
    const el = document.getElementById('view-' + v);
    if (el) el.style.display = (v === view) ? (v === 'list' || v === 'stack' || v === 'calendar' ? 'block' : '') : 'none';
  });
  
  if (view === 'shelf') {
    document.querySelector('.bookshelf-view').style.display = '';
    document.getElementById('view-list').style.display = 'none';
    document.getElementById('view-calendar').style.display = 'none';
    document.getElementById('view-stack').style.display = 'none';
  } else if (view === 'list') {
    document.querySelector('.bookshelf-view').style.display = 'none';
    document.getElementById('view-list').style.display = 'block';
    document.getElementById('view-calendar').style.display = 'none';
    document.getElementById('view-stack').style.display = 'none';
  } else if (view === 'calendar') {
    document.querySelector('.bookshelf-view').style.display = 'none';
    document.getElementById('view-list').style.display = 'none';
    document.getElementById('view-calendar').style.display = 'block';
    document.getElementById('view-stack').style.display = 'none';
  } else if (view === 'stack') {
    document.querySelector('.bookshelf-view').style.display = 'none';
    document.getElementById('view-list').style.display = 'none';
    document.getElementById('view-calendar').style.display = 'none';
    document.getElementById('view-stack').style.display = 'block';
  }
}

// ========== WRITE ==========
function initWriteScreen() {
  state.selectedCategory = '';
  state.currentRating = 0;
  state.tags = [];
  state.selectedColor = '#c8a55c';
  state.selectedPattern = 'none';
  
  document.getElementById('write-title').value = '';
  document.getElementById('write-date').value = new Date().toISOString().split('T')[0];
  document.getElementById('write-review').value = '';
  document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('selected'));
  document.querySelectorAll('.star').forEach(s => s.classList.remove('active'));
  document.getElementById('contextual-fields').innerHTML = '';
  document.getElementById('tag-wrapper').innerHTML = '<input class="tag-input" id="tag-input" placeholder="#ì¸ìƒì‘ #ìš°ìš¸í• ë•Œ" onkeydown="handleTag(event)">';
  document.getElementById('ticket-upload-section').classList.remove('visible');
  
  // Color picker
  const colorPicker = document.getElementById('color-picker');
  colorPicker.innerHTML = '';
  SPINE_COLORS.forEach((c, i) => {
    const swatch = document.createElement('div');
    swatch.className = 'color-swatch' + (i === 0 ? ' selected' : '');
    swatch.style.background = c;
    swatch.onclick = () => {
      document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('selected'));
      swatch.classList.add('selected');
      state.selectedColor = c;
    };
    colorPicker.appendChild(swatch);
  });
  
  // Pattern picker
  const patternPicker = document.getElementById('pattern-picker');
  patternPicker.innerHTML = '';
  PATTERNS.forEach((p, i) => {
    const chip = document.createElement('div');
    chip.className = 'pattern-chip' + (i === 0 ? ' selected' : '');
    chip.textContent = p.name;
    chip.onclick = () => {
      document.querySelectorAll('.pattern-chip').forEach(c => c.classList.remove('selected'));
      chip.classList.add('selected');
      state.selectedPattern = p.id;
    };
    patternPicker.appendChild(chip);
  });
}

function selectCategory(el) {
  document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('selected'));
  el.classList.add('selected');
  state.selectedCategory = el.dataset.cat;
  
  // Show ticket upload for applicable categories
  const ticketCats = ['ì˜í™”', 'ì—°ê·¹', 'íšŒí™”'];
  const ticketSection = document.getElementById('ticket-upload-section');
  ticketSection.classList.toggle('visible', ticketCats.includes(state.selectedCategory));
  
  // Contextual fields
  const ctx = document.getElementById('contextual-fields');
  ctx.innerHTML = '';
  
  const fields = {
    'ìŒì•…': '<div class="write-section"><div class="write-label">ğŸµ ì´ ê³¡ì„ ë“£ê¸° ì¢‹ì€ ì‹œê°„ëŒ€</div><input class="write-input" placeholder="ì˜ˆ: ìƒˆë²½ 2ì‹œ, ë¹„ ì˜¤ëŠ” ì˜¤í›„"></div>',
    'ê±´ì¶•': '<div class="write-section"><div class="write-label">ğŸ›ï¸ ë°©ë¬¸ ì¥ì†Œ</div><input class="write-input" placeholder="ì˜ˆ: ì„œìš¸ DDP"></div><div class="write-section"><div class="write-label">ê³µê°„ì˜ ë¶„ìœ„ê¸°</div><input class="write-input" placeholder="ì˜ˆ: ë¯¸ë˜ì ì¸, ì°¨ê°€ìš´, ì••ë„ì ì¸"></div>',
    'íšŒí™”': '<div class="write-section"><div class="write-label">ğŸ¨ ì „ì‹œíšŒ ì´ë¦„</div><input class="write-input" placeholder="ì˜ˆ: ë°˜ ê³ í ëª°ì…í˜• ì „ì‹œ"></div><div class="write-section"><div class="write-label">ê°€ì¥ ì˜¤ë˜ ë¨¸ë¬¸ ê·¸ë¦¼</div><input class="write-input" placeholder="ì˜ˆ: ë³„ì´ ë¹›ë‚˜ëŠ” ë°¤"></div>',
  };
  
  if (fields[state.selectedCategory]) {
    ctx.innerHTML = fields[state.selectedCategory];
  }
}

function setRating(val) {
  state.currentRating = val;
  document.querySelectorAll('.star').forEach(s => {
    s.classList.toggle('active', parseInt(s.dataset.val) <= val);
  });
}

function handleTag(e) {
  if (e.key === 'Enter' || e.key === ' ') {
    e.preventDefault();
    const input = document.getElementById('tag-input');
    let tag = input.value.trim();
    if (!tag) return;
    if (!tag.startsWith('#')) tag = '#' + tag;
    
    state.tags.push(tag);
    const chip = document.createElement('span');
    chip.className = 'tag-chip';
    chip.innerHTML = `${tag} <span class="tag-remove" onclick="removeTag(this, '${tag}')">Ã—</span>`;
    document.getElementById('tag-wrapper').insertBefore(chip, input);
    input.value = '';
  }
}

function removeTag(el, tag) {
  state.tags = state.tags.filter(t => t !== tag);
  el.parentElement.remove();
}

function submitBook() {
  const title = document.getElementById('write-title').value || 'ë¬´ì œ';
  const date = document.getElementById('write-date').value;
  const review = document.getElementById('write-review').value;
  
  const catObj = CATEGORIES.find(c => c.name === state.selectedCategory) || CATEGORIES[0];
  const reviewLen = review.length;
  const thickness = Math.max(16, Math.min(40, 16 + Math.floor(reviewLen / 20)));
  
  const newBook = {
    id: Date.now(),
    title,
    category: catObj.name,
    emoji: catObj.emoji,
    color: state.selectedColor,
    rating: state.currentRating,
    review,
    tags: [...state.tags],
    date,
    thickness,
    pattern: state.selectedPattern,
  };
  
  state.books.push(newBook);
  
  // Animation
  const overlay = document.getElementById('book-fly-overlay');
  const flyBook = document.getElementById('flying-book');
  flyBook.style.background = state.selectedColor;
  flyBook.textContent = title;
  overlay.classList.add('active');
  
  setTimeout(() => {
    overlay.classList.remove('active');
    const toast = document.getElementById('xp-toast');
    toast.classList.add('show');
    setTimeout(() => {
      toast.classList.remove('show');
      goTo('dashboard');
    }, 1200);
  }, 1300);
}

// ========== COMMUNITY ==========
function renderCommunity() {
  const feed = document.getElementById('community-feed');
  feed.innerHTML = '';
  
  communityPosts.forEach(post => {
    const card = document.createElement('div');
    card.className = 'feed-card';
    card.onclick = () => openCommunityDetail(post);
    card.innerHTML = `
      <div class="feed-cover" style="background:${post.color}">
        <span style="position:relative;z-index:1;">${post.emoji}</span>
      </div>
      <div class="feed-info">
        <div class="feed-work-title">${post.title}</div>
        <div class="feed-author">by ${post.user}</div>
        <div class="feed-excerpt">${post.excerpt}</div>
      </div>
      <div class="feed-footer">
        <div class="feed-stars">${'â˜…'.repeat(Math.floor(post.rating))}</div>
        <div class="feed-likes">â™¥ ${post.likes}</div>
      </div>
    `;
    feed.appendChild(card);
  });
}

function selectFilter(el) {
  document.querySelectorAll('.filter-chip').forEach(f => f.classList.remove('active'));
  el.classList.add('active');
}

// ========== DETAIL ==========
function openDetail(book) {
  const modal = document.getElementById('detail-modal');
  modal.classList.add('active');
  
  document.getElementById('detail-visual').innerHTML = `
    <div class="detail-open-book">
      <div class="book-left" style="border-left: 6px solid ${book.color};">
        <div class="detail-category-emoji">${book.emoji}</div>
        <div class="detail-title-text">${book.title}</div>
        <div class="detail-rating">${'â˜…'.repeat(Math.floor(book.rating))} ${book.rating}</div>
      </div>
      <div class="book-right">${book.review.substring(0, 100)}${book.review.length > 100 ? '...' : ''}</div>
    </div>
  `;
  
  document.getElementById('detail-body').innerHTML = `
    <div class="detail-section">
      <div class="detail-label">ë¦¬ë·°</div>
      <div class="detail-review-text">${book.review}</div>
    </div>
    <div class="detail-section">
      <div class="detail-label">ì •ë³´</div>
      <div class="detail-review-text">${book.category} Â· ${book.date}</div>
    </div>
    ${book.tags && book.tags.length ? `
    <div class="detail-section">
      <div class="detail-label">íƒœê·¸</div>
      <div class="detail-tags">${book.tags.map(t => `<span class="detail-tag">${t}</span>`).join('')}</div>
    </div>` : ''}
    <div class="detail-actions">
      <button class="action-btn" onclick="alert('â¤ï¸ ì¢‹ì•„ìš”!')">â™¥ ì¢‹ì•„ìš”</button>
      <button class="action-btn" onclick="alert('ğŸ“‹ ìŠ¤í¬ë© ì™„ë£Œ!')">ğŸ“‹ ìŠ¤í¬ë©</button>
      <button class="action-btn" onclick="alert('ğŸ’¬ ëŒ“ê¸€')">ğŸ’¬ ëŒ“ê¸€</button>
    </div>
  `;
}

function openCommunityDetail(post) {
  openDetail({
    ...post,
    review: post.excerpt,
    date: '2026-02',
    tags: [],
  });
}

function closeDetail() {
  document.getElementById('detail-modal').classList.remove('active');
}

// ========== SEARCH ==========
function openSearch() {
  document.getElementById('search-modal').classList.add('active');
  setTimeout(() => document.getElementById('search-input').focus(), 100);
}

function closeSearch() {
  document.getElementById('search-modal').classList.remove('active');
  document.getElementById('search-input').value = '';
}

function handleSearch() {
  const query = document.getElementById('search-input').value.toLowerCase().trim();
  const results = document.getElementById('search-results');
  
  if (!query) {
    results.innerHTML = '<div class="search-empty">ğŸ” ì„œì¬ì—ì„œ ê¸°ë¡ì„ ì°¾ì•„ë³´ì„¸ìš”</div>';
    return;
  }
  
  const matched = state.books.filter(b => 
    b.title.toLowerCase().includes(query) ||
    b.category.includes(query) ||
    b.tags.some(t => t.toLowerCase().includes(query)) ||
    b.review.toLowerCase().includes(query)
  );
  
  if (!matched.length) {
    results.innerHTML = '<div class="search-empty">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤ ğŸ˜¢</div>';
    return;
  }
  
  results.innerHTML = '';
  matched.forEach(book => {
    const item = document.createElement('div');
    item.className = 'list-item';
    item.onclick = () => { closeSearch(); openDetail(book); };
    item.innerHTML = `
      <div class="list-color-bar" style="background:${book.color}"></div>
      <div class="list-info">
        <div class="list-title">${book.emoji} ${book.title}</div>
        <div class="list-meta">${book.category} Â· ${book.date}</div>
      </div>
      <div class="list-rating">${'â˜…'.repeat(Math.floor(book.rating))}</div>
    `;
    results.appendChild(item);
  });
}

// ========== STATS ==========
function renderStats() {
  renderRadar();
  renderMonthlyChart();
  renderCollection();
}

function renderRadar() {
  const svg = document.getElementById('radar-chart');
  const cx = 150, cy = 150, r = 100;
  const cats = CATEGORIES;
  const angles = cats.map((_, i) => (Math.PI * 2 * i / cats.length) - Math.PI / 2);
  
  const counts = cats.map(c => state.books.filter(b => b.category === c.name).length);
  const maxCount = Math.max(...counts, 1);
  
  let html = '';
  
  // Grid circles
  [0.25, 0.5, 0.75, 1].forEach(scale => {
    const points = angles.map(a => `${cx + r * scale * Math.cos(a)},${cy + r * scale * Math.sin(a)}`).join(' ');
    html += `<polygon points="${points}" fill="none" stroke="rgba(255,255,255,0.06)" stroke-width="1"/>`;
  });
  
  // Axis lines
  angles.forEach(a => {
    html += `<line x1="${cx}" y1="${cy}" x2="${cx + r * Math.cos(a)}" y2="${cy + r * Math.sin(a)}" stroke="rgba(255,255,255,0.06)" stroke-width="1"/>`;
  });
  
  // Data polygon
  const dataPoints = counts.map((c, i) => {
    const scale = c / maxCount;
    return `${cx + r * scale * Math.cos(angles[i])},${cy + r * scale * Math.sin(angles[i])}`;
  }).join(' ');
  html += `<polygon points="${dataPoints}" fill="rgba(200,165,92,0.15)" stroke="var(--accent-gold)" stroke-width="2"/>`;
  
  // Data dots + labels
  counts.forEach((c, i) => {
    const scale = c / maxCount;
    const x = cx + r * scale * Math.cos(angles[i]);
    const y = cy + r * scale * Math.sin(angles[i]);
    html += `<circle cx="${x}" cy="${y}" r="4" fill="var(--accent-gold)"/>`;
    
    const lx = cx + (r + 25) * Math.cos(angles[i]);
    const ly = cy + (r + 25) * Math.sin(angles[i]);
    html += `<text x="${lx}" y="${ly}" fill="var(--text-secondary)" font-size="11" text-anchor="middle" dominant-baseline="middle">${cats[i].emoji} ${c}</text>`;
  });
  
  svg.innerHTML = html;
}

function renderMonthlyChart() {
  const container = document.getElementById('monthly-chart');
  container.innerHTML = '';
  const months = ['1ì›”','2ì›”','3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”'];
  const monthlyCounts = months.map((_, i) => {
    const m = String(i + 1).padStart(2, '0');
    return state.books.filter(b => b.date.includes(`-${m}-`)).length;
  });
  const maxM = Math.max(...monthlyCounts, 1);
  
  months.forEach((label, i) => {
    const col = document.createElement('div');
    col.className = 'month-bar';
    const height = Math.max(4, (monthlyCounts[i] / maxM) * 100);
    col.innerHTML = `<div class="bar" style="height:${height}px;"></div><div class="month-label">${label}</div>`;
    container.appendChild(col);
  });
}

function renderCollection() {
  const grid = document.getElementById('collection-grid');
  grid.innerHTML = '';
  
  const skins = [
    { emoji: 'ğŸ¦‰', name: 'ì˜¬ë¹¼ë¯¸', unlocked: true },
    { emoji: 'ğŸ±', name: 'ê³ ì–‘ì´', unlocked: true },
    { emoji: 'ğŸ¦Š', name: 'ì—¬ìš°', unlocked: true },
    { emoji: 'ğŸ»', name: 'ê³°', unlocked: false },
    { emoji: 'ğŸ§', name: 'í­ê·„', unlocked: false },
    { emoji: 'ğŸ¦”', name: 'ê³ ìŠ´ë„ì¹˜', unlocked: false },
    { emoji: 'ğŸ¦‹', name: 'ë‚˜ë¹„', unlocked: false },
    { emoji: 'ğŸ‰', name: 'ìš©', unlocked: false },
  ];
  
  skins.forEach(skin => {
    const item = document.createElement('div');
    item.className = 'collection-item' + (skin.unlocked ? '' : ' locked');
    item.innerHTML = `
      <div class="collection-icon" style="background:${skin.unlocked ? 'var(--bg-card)' : 'rgba(255,255,255,0.02)'};">${skin.emoji}</div>
      <div class="collection-name">${skin.unlocked ? skin.name : '???'}</div>
    `;
    grid.appendChild(item);
  });
}

// ========== INIT ==========
document.addEventListener('DOMContentLoaded', () => {
  // Set today's date
  const dateInput = document.getElementById('write-date');
  if (dateInput) dateInput.value = new Date().toISOString().split('T')[0];
});
</script>
</body>
</html>